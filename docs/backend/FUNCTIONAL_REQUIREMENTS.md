# 기능 요구사항 문서

> 이 문서는 프론트엔드 프로토타입 기반으로 백엔드가 구현해야 할 기능 요구사항을 정의합니다.

---

## 목차

1. [인증 시스템](#1-인증-시스템)
2. [아티클 관리](#2-아티클-관리)
3. [댓글 시스템](#3-댓글-시스템)
4. [검색 기능](#4-검색-기능)
5. [사용자 프로필](#5-사용자-프로필)
6. [설정 관리](#6-설정-관리)
7. [알림 시스템](#7-알림-시스템)

---

## 1. 인증 시스템

### 1.1 회원가입 (US-AUTH-001)

**유저 스토리**
> 사용자로서, 이메일 또는 소셜 계정으로 회원가입하여 커뮤니티 서비스를 이용하고 싶다.

**인수 조건**
- [ ] 이메일, 이름, 비밀번호로 회원가입 가능
- [ ] 비밀번호는 최소 8자 이상, 영문+숫자+특수문자 조합
- [ ] 이메일 중복 검사 실시간 지원
- [ ] 이용약관 및 개인정보처리방침 동의 필수
- [ ] 회원가입 완료 후 이메일 인증 발송
- [ ] Google OAuth 회원가입 지원
- [ ] GitHub OAuth 회원가입 지원

**비즈니스 로직**
```
1. 이메일 형식 검증
2. 이메일 중복 확인 (users 테이블)
3. 비밀번호 정책 검증
4. 비밀번호 해시 (bcrypt)
5. 사용자 레코드 생성
6. 이메일 인증 토큰 생성
7. 인증 이메일 발송 (큐 사용)
8. 환영 알림 생성
```

**데이터 요구사항**
| 필드 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| email | varchar(255) | unique, not null | 이메일 주소 |
| name | varchar(100) | not null | 사용자 이름 |
| password | varchar(255) | not null | 해시된 비밀번호 |
| email_verified_at | timestamp | nullable | 이메일 인증 일시 |

---

### 1.2 로그인 (US-AUTH-002)

**유저 스토리**
> 사용자로서, 이메일/비밀번호 또는 소셜 계정으로 로그인하여 나의 계정에 접근하고 싶다.

**인수 조건**
- [ ] 이메일 + 비밀번호 로그인 지원
- [ ] "로그인 상태 유지" 옵션 (Remember me)
- [ ] 로그인 실패 시 명확한 에러 메시지
- [ ] 5회 연속 실패 시 10분간 계정 잠금
- [ ] Google OAuth 로그인 지원
- [ ] GitHub OAuth 로그인 지원
- [ ] 로그인 성공 시 마지막 로그인 일시 기록

**비즈니스 로직**
```
1. 이메일로 사용자 조회
2. 계정 잠금 상태 확인
3. 비밀번호 검증
4. 실패 시 실패 횟수 증가
5. 성공 시 실패 횟수 초기화
6. 세션/토큰 생성
7. 마지막 로그인 일시 업데이트
```

---

### 1.3 비밀번호 재설정 (US-AUTH-003)

**유저 스토리**
> 사용자로서, 비밀번호를 잊어버렸을 때 이메일을 통해 비밀번호를 재설정하고 싶다.

**인수 조건**
- [ ] 이메일 입력으로 재설정 링크 발송
- [ ] 재설정 토큰은 1시간 유효
- [ ] 새 비밀번호는 기존 비밀번호와 달라야 함
- [ ] 재설정 완료 시 모든 기존 세션 무효화

**비즈니스 로직**
```
1. 이메일로 사용자 존재 확인
2. 기존 재설정 토큰 무효화
3. 새 토큰 생성 (60자, 1시간 유효)
4. 재설정 이메일 발송
5. 토큰 검증 및 비밀번호 변경
6. 모든 기존 세션 삭제
```

---

### 1.4 로그아웃 (US-AUTH-004)

**유저 스토리**
> 사용자로서, 안전하게 로그아웃하여 내 계정을 보호하고 싶다.

**인수 조건**
- [ ] 현재 세션/토큰 무효화
- [ ] 옵션: 모든 디바이스에서 로그아웃

---

## 2. 아티클 관리

### 2.1 아티클 작성 (US-ART-001)

**유저 스토리**
> 사용자로서, 마크다운 에디터를 사용해 기술 아티클을 작성하고 공유하고 싶다.

**인수 조건**
- [ ] 마크다운 형식 지원
- [ ] 제목 (최대 200자)
- [ ] 본문 (최대 100,000자)
- [ ] 카테고리 선택 (기술, 커리어, 일상)
- [ ] 태그 추가 (최대 5개)
- [ ] 이미지 업로드 및 삽입
- [ ] 임시저장 기능 (자동저장 30초)
- [ ] 미리보기 기능
- [ ] 공개/비공개 설정

**비즈니스 로직**
```
1. 입력값 검증
2. 마크다운 → HTML 변환 (저장 시)
3. XSS 필터링
4. 이미지 URL 검증
5. 태그 파싱 및 생성/연결
6. 슬러그 생성 (제목 기반, 중복 시 숫자 추가)
7. 아티클 저장
8. 팔로워 알림 발송 (공개 글일 경우)
```

**데이터 요구사항**
| 필드 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| title | varchar(200) | not null | 제목 |
| slug | varchar(250) | unique, not null | URL 슬러그 |
| content | text | not null | 마크다운 본문 |
| content_html | text | not null | 렌더링된 HTML |
| excerpt | varchar(300) | nullable | 요약 (자동 생성) |
| category | enum | not null | 카테고리 |
| status | enum | not null | draft, published, private |
| view_count | integer | default 0 | 조회수 |
| user_id | bigint | foreign key | 작성자 |
| published_at | timestamp | nullable | 발행일 |

---

### 2.2 아티클 수정 (US-ART-002)

**유저 스토리**
> 작성자로서, 내가 작성한 아티클을 수정하여 내용을 개선하고 싶다.

**인수 조건**
- [ ] 본인 작성 글만 수정 가능
- [ ] 수정 이력 보존 (최근 10개 버전)
- [ ] 수정 시간 표시 ("수정됨" 라벨)

**비즈니스 로직**
```
1. 작성자 권한 확인
2. 기존 버전 백업
3. 변경사항 적용
4. updated_at 갱신
```

---

### 2.3 아티클 삭제 (US-ART-003)

**유저 스토리**
> 작성자로서, 내가 작성한 아티클을 삭제하고 싶다.

**인수 조건**
- [ ] 본인 작성 글만 삭제 가능
- [ ] 소프트 삭제 적용 (30일 후 완전 삭제)
- [ ] 삭제 시 연관 댓글, 좋아요 함께 처리

---

### 2.4 아티클 목록 조회 (US-ART-004)

**유저 스토리**
> 사용자로서, 다양한 조건으로 아티클 목록을 탐색하고 싶다.

**인수 조건**
- [ ] 페이지네이션 (기본 20개)
- [ ] 정렬 옵션: 최신순, 인기순, 댓글순
- [ ] 카테고리 필터
- [ ] 리스트/그리드 뷰 지원
- [ ] 무한 스크롤 지원 (옵션)

**비즈니스 로직**
```
1. 필터 조건 파싱
2. 정렬 조건 적용
3. 페이지네이션 적용
4. 작성자 정보 eager loading
5. 좋아요 수, 댓글 수 집계
```

---

### 2.5 아티클 상세 조회 (US-ART-005)

**유저 스토리**
> 사용자로서, 아티클의 전체 내용을 읽고 싶다.

**인수 조건**
- [ ] 마크다운 렌더링된 본문 표시
- [ ] 작성자 정보 표시
- [ ] 조회수 증가 (동일 사용자 24시간 내 중복 방지)
- [ ] 좋아요 수, 댓글 수 표시
- [ ] 관련 아티클 추천

**비즈니스 로직**
```
1. 슬러그로 아티클 조회
2. 비공개 글 접근 권한 확인
3. 조회수 증가 (IP/사용자 기반 중복 방지)
4. 관련 아티클 조회 (같은 태그, 같은 작성자)
```

---

### 2.6 아티클 좋아요 (US-ART-006)

**유저 스토리**
> 사용자로서, 마음에 드는 아티클에 좋아요를 표시하고 싶다.

**인수 조건**
- [ ] 로그인 사용자만 가능
- [ ] 토글 방식 (좋아요/취소)
- [ ] 실시간 좋아요 수 업데이트
- [ ] 좋아요 시 작성자에게 알림

---

### 2.7 임시저장 (US-ART-007)

**유저 스토리**
> 사용자로서, 작성 중인 글을 자동/수동으로 임시저장하고 싶다.

**인수 조건**
- [ ] 자동저장 (30초 간격)
- [ ] 수동저장 버튼
- [ ] 임시저장 목록 관리
- [ ] 임시저장 글 불러오기

---

## 3. 댓글 시스템

### 3.1 댓글 작성 (US-CMT-001)

**유저 스토리**
> 사용자로서, 아티클에 댓글을 작성하여 의견을 공유하고 싶다.

**인수 조건**
- [ ] 로그인 사용자만 작성 가능
- [ ] 최대 1,000자
- [ ] 마크다운 지원 (제한적)
- [ ] 댓글 작성 시 작성자에게 알림

**데이터 요구사항**
| 필드 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| content | text | not null, max 1000 | 댓글 내용 |
| article_id | bigint | foreign key | 아티클 ID |
| user_id | bigint | foreign key | 작성자 ID |
| parent_id | bigint | nullable, foreign key | 부모 댓글 (대댓글) |

---

### 3.2 대댓글 (US-CMT-002)

**유저 스토리**
> 사용자로서, 특정 댓글에 답글을 달아 대화하고 싶다.

**인수 조건**
- [ ] 2단계 깊이까지 지원
- [ ] 원 댓글 작성자 멘션 자동 추가
- [ ] 대댓글 작성 시 원 댓글 작성자에게 알림

---

### 3.3 댓글 수정/삭제 (US-CMT-003)

**유저 스토리**
> 작성자로서, 내 댓글을 수정하거나 삭제하고 싶다.

**인수 조건**
- [ ] 본인 댓글만 수정/삭제 가능
- [ ] 삭제 시 "삭제된 댓글입니다" 표시 (대댓글 있을 경우)
- [ ] 대댓글 없으면 완전 삭제

---

### 3.4 댓글 좋아요 (US-CMT-004)

**유저 스토리**
> 사용자로서, 유용한 댓글에 좋아요를 표시하고 싶다.

**인수 조건**
- [ ] 로그인 사용자만 가능
- [ ] 토글 방식
- [ ] 좋아요 많은 댓글 상단 노출 옵션

---

## 4. 검색 기능

### 4.1 통합 검색 (US-SCH-001)

**유저 스토리**
> 사용자로서, 키워드로 아티클, 사용자, 태그를 검색하고 싶다.

**인수 조건**
- [ ] 아티클 제목, 본문 검색
- [ ] 사용자 이름, username 검색
- [ ] 태그 검색
- [ ] 검색어 하이라이트
- [ ] 검색 결과 타입별 분류

**비즈니스 로직**
```
1. 검색어 정규화 (공백 제거, 소문자 변환)
2. 아티클 전문 검색 (Full-text search)
3. 사용자 검색
4. 태그 검색
5. 결과 합산 및 정렬
6. 검색어 하이라이트 처리
```

---

### 4.2 필터링 (US-SCH-002)

**유저 스토리**
> 사용자로서, 검색 결과를 세부 조건으로 필터링하고 싶다.

**인수 조건**
- [ ] 유형별 필터: 전체, 아티클, 사용자, 태그
- [ ] 기간별 필터: 오늘, 이번 주, 이번 달, 올해, 전체
- [ ] 정렬: 관련도순, 최신순, 인기순

---

## 5. 사용자 프로필

### 5.1 프로필 조회 (US-USR-001)

**유저 스토리**
> 사용자로서, 다른 사용자의 프로필과 활동 내역을 확인하고 싶다.

**인수 조건**
- [ ] 사용자 기본 정보 표시 (이름, 소개, 위치, 링크)
- [ ] 팔로워/팔로잉 수
- [ ] 가입일
- [ ] 작성 아티클 목록 (탭)
- [ ] 작성 댓글 목록 (탭)
- [ ] 좋아요한 아티클 목록 (탭)

**데이터 요구사항**
| 필드 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| username | varchar(30) | unique, not null | 고유 사용자명 |
| bio | varchar(200) | nullable | 자기소개 |
| location | varchar(100) | nullable | 위치 |
| website | varchar(255) | nullable | 웹사이트 |
| avatar_url | varchar(255) | nullable | 프로필 이미지 |

---

### 5.2 팔로우 (US-USR-002)

**유저 스토리**
> 사용자로서, 관심 있는 사용자를 팔로우하여 그들의 새 글을 받아보고 싶다.

**인수 조건**
- [ ] 로그인 사용자만 팔로우 가능
- [ ] 자기 자신 팔로우 불가
- [ ] 팔로우/언팔로우 토글
- [ ] 팔로우 시 상대방에게 알림
- [ ] 팔로워/팔로잉 목록 조회

**데이터 요구사항**
| 필드 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| follower_id | bigint | foreign key | 팔로우 하는 사용자 |
| following_id | bigint | foreign key | 팔로우 받는 사용자 |
| created_at | timestamp | not null | 팔로우 일시 |

---

## 6. 설정 관리

### 6.1 프로필 설정 (US-SET-001)

**유저 스토리**
> 사용자로서, 내 프로필 정보를 수정하고 싶다.

**인수 조건**
- [ ] 이름 변경
- [ ] username 변경 (30일에 1회)
- [ ] 자기소개 수정
- [ ] 위치 수정
- [ ] 웹사이트 수정
- [ ] 프로필 이미지 업로드/변경

---

### 6.2 계정 설정 (US-SET-002)

**유저 스토리**
> 사용자로서, 이메일과 비밀번호를 변경하고 싶다.

**인수 조건**
- [ ] 이메일 변경 (재인증 필요)
- [ ] 비밀번호 변경 (현재 비밀번호 확인)
- [ ] 계정 비활성화
- [ ] 계정 삭제 (30일 유예 기간)

---

### 6.3 알림 설정 (US-SET-003)

**유저 스토리**
> 사용자로서, 받고 싶은 알림을 설정하고 싶다.

**인수 조건**
- [ ] 이메일 알림 On/Off
  - 새 팔로워
  - 댓글 알림
  - 좋아요 알림
  - 뉴스레터
- [ ] 푸시 알림 On/Off (향후)

---

### 6.4 보안 설정 (US-SET-004)

**유저 스토리**
> 사용자로서, 내 계정의 보안을 관리하고 싶다.

**인수 조건**
- [ ] 활성 세션 목록 조회
- [ ] 특정 세션 종료
- [ ] 모든 세션 종료
- [ ] 소셜 계정 연결/해제

---

## 7. 알림 시스템

### 7.1 알림 수신 (US-NTF-001)

**유저 스토리**
> 사용자로서, 나와 관련된 활동에 대한 알림을 받고 싶다.

**알림 유형**
| 유형 | 트리거 | 수신자 |
|------|--------|--------|
| new_follower | 누군가 나를 팔로우 | 피팔로우 사용자 |
| article_like | 내 글에 좋아요 | 글 작성자 |
| article_comment | 내 글에 댓글 | 글 작성자 |
| comment_reply | 내 댓글에 답글 | 댓글 작성자 |
| comment_like | 내 댓글에 좋아요 | 댓글 작성자 |
| mention | 댓글에서 멘션 | 멘션된 사용자 |

**데이터 요구사항**
| 필드 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| user_id | bigint | foreign key | 수신자 |
| type | varchar(50) | not null | 알림 유형 |
| data | json | not null | 알림 데이터 |
| read_at | timestamp | nullable | 읽음 일시 |

---

### 7.2 알림 조회 및 관리 (US-NTF-002)

**유저 스토리**
> 사용자로서, 받은 알림을 확인하고 관리하고 싶다.

**인수 조건**
- [ ] 알림 목록 조회 (최신순)
- [ ] 읽지 않은 알림 개수 표시
- [ ] 개별 알림 읽음 처리
- [ ] 전체 읽음 처리
- [ ] 알림 삭제

---

## 부록: 데이터베이스 ERD 요약

```
users
├── articles (1:N)
├── comments (1:N)
├── likes (1:N)
├── notifications (1:N)
├── followers (N:M via follows)
├── following (N:M via follows)
└── sessions (1:N)

articles
├── comments (1:N)
├── likes (1:N)
├── tags (N:M via article_tag)
└── drafts (1:N)

comments
├── replies (self-referential 1:N)
└── likes (1:N)

tags
└── articles (N:M via article_tag)
```

---

## 부록: 비기능 요구사항

### 성능
- 페이지 로드: 3초 이내
- API 응답: 500ms 이내
- 검색 응답: 1초 이내

### 확장성
- 동시 접속자 1,000명 지원
- 일일 아티클 작성 10,000건 처리

### 보안
- HTTPS 필수
- CSRF 보호
- XSS 방지
- SQL Injection 방지
- Rate Limiting 적용

### 가용성
- 서비스 가용성 99.9%
- 데이터 백업 일 1회

---

*문서 버전: 1.0*
*최종 업데이트: 2026-01-17*
